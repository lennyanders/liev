const e=e=>"string"==typeof e,t=e=>"function"==typeof e,n=e=>e instanceof HTMLElement,s=(e,t)=>void 0===e?!t.toString().includes(".preventDefault()"):e;let c=!1;try{const e=Object.defineProperty({},"passive",{get(){c=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(e){}const o=new WeakMap,r=(c,r,l,{once:a,element:i=document.documentElement,passive:d}={})=>{if(!(e(c)&&e(r)&&t(l)&&n(i)))return console.warn("couldn't detach listener."),!1;const u=s(d,l),v=o.get(i);if(!v)return!1;const f=v[c];if(!f)return!1;const m=f[u];if(!m)return!1;const p=m.findIndex(e=>e.selector===r&&e.callback===l&&e.once===a);return-1!==p&&(1===m.length?(i.removeEventListener(c,m.handler,{passive:u}),delete f[u],!0):(m.splice(p,1),!0))},l=(e,t,n)=>{const s=((e,t,n)=>s=>{o.get(e)[t][n].forEach(({selector:o,callback:l,once:a})=>{const i=o?s.target.closest(o):s.target;i&&(!n||c&&!s.defaultPrevented||(s.preventDefault=()=>{}),l(i,s),a&&r(t,o,l,{once:a,element:e,passive:n}))})})(e,t,n);o.get(e)[t][n].handler=s,e.addEventListener(t,s,{passive:n})},a=(c,r,a,{once:i,element:d=document.documentElement,passive:u}={})=>{if(!(e(c)&&e(r)&&t(a)&&n(d)))return console.warn("couldn't attach listener."),!1;const v=s(u,a),f={selector:r,callback:a,...i&&{once:i}},m=o.get(d);if(!m)return o.set(d,{[c]:{[v]:[f]}}),l(d,c,v),!0;const p=m[c];if(!p)return m[c]={[v]:[f]},l(d,c,v),!0;const E=p[v];return E?(E.push(f),!0):(p[v]=[f],l(d,c,v),!0)},i=(t,s=document.documentElement,c)=>!(!n(s)||!e(t))&&(s.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:c})),!0);export{i as emit,r as off,a as on};
